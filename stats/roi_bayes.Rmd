---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.11.1
  kernelspec:
    display_name: R
    language: R
    name: ir
output: 
  html_document:
    theme: spacelab
title: ROI analysis
---

This analysis takes the parameter estimates extracted from first level con files with `spm_summarise` and compares them between groups (friend vs stranger).

The following regions have been selected:

- Anterior insula (AI)
- Anterior mid-cingulate cortex (aMCC)
- Amygdala
- Fusiform face Area (FFA)
- Right posterior Superior Temporal Sulcus (rpSTS)
- Right temporo-parietal junction (rTPJ).

All ROIs were based on Neurovault collection [Computing the Social Brain Connectome Across Systems and States](https://neurovault.org/collections/2462/) and a corresponding [article](https://academic.oup.com/cercor/article/28/7/2207/3831104) with the same title. The AI, amygdala and FFA ROIs from both hemispheres were merged (ie. parameters estimates were averaged over voxels from left and right hemisphere), while lateralised definitions were used for rpSTS and rTPJ, and there was only one, non-lateralised, aMCC seed in the collection.

For each region, groups (friend vs stranger) are compared using `t.test` from built-in `stats` and `ttestBF` from `BayesFactor`.

```{r, message=FALSE}
library('tidyverse')
library('BayesFactor')
library('ggpubr')
library('ini')
```

## Data import

Required data are generated by `spm/complete/roi/extract_from_roi.m`.
There are two files for OFL, the primary one based on US > noUS contrast, and the other based on US stick contrast.
The file for DE is baserd on the CS+ > CS- contrast.

```{r}
config <- read.ini("../config.ini")
data_dir <- file.path(config$SPM$ROOT, "complete", "other")

ofl <- read_csv(file.path(data_dir, "roi_stats_ofl.csv"), col_types = cols())
de <- read_csv(file.path(data_dir, "roi_stats_de.csv"), col_types = cols())
ofl_us <- read_csv(file.path(data_dir, "roi_stats_ofl-us.csv"), col_types = cols())
```

If the figures directory does not exist, create it here:
```{r}
if(!dir.exists("figures")) {
    dir.create("figures")
}
```

## OFL - figure

Contrast estimates & 95 % confidence intervals for the observational UR (obs US - obs noUS).

```{r}
ofl_plot <- ofl %>%
    mutate(group = as.factor(group)) %>%
    pivot_longer(cols = where(is.numeric), names_to = "roi", values_to = "contrast estimate") %>%
    ggbarplot(x = "group", y = "contrast estimate", facet.by = "roi", add = "mean_ci",
              color = "group", palette = c("#E66100", "#5D3A9B"))

ggexport(ofl_plot, filename = "figures/roi_ofl.png")
ofl_plot
```

## DE - figure

Contrast estimates & 95 % confidence intervals for the direct CR (CS+ - CS-)

```{r}
de_plot <- de %>%
    mutate(group = as.factor(group)) %>%
    pivot_longer(cols = where(is.numeric), names_to = "roi", values_to = "contrast estimate") %>%
    ggbarplot(x = "group", y = "contrast estimate", facet.by = "roi", add = "mean_ci",
              color = "group", palette = c("#E66100", "#5D3A9B"))

ggexport(de_plot, filename = "figures/roi_de.png")
de_plot
```

## OFL (US) - figure

```{r}
ofl_us_plot <- ofl_us %>%
    mutate(group = as.factor(group)) %>%
    pivot_longer(cols = where(is.numeric), names_to = "roi", values_to = "contrast estimate") %>%
    ggbarplot(x = "group", y = "contrast estimate", facet.by = "roi", add = "mean_ci",
              color = "group", palette = c("#E66100", "#5D3A9B"))

ggexport(ofl_us_plot, filename = "figures/roi_ofl-us.png")
ofl_us_plot
```

## OFL - stats

Below is a rundown of all t-tests (classical and bayesian).

### OFL AI

```{r}
frm = AI ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

### OFL aMCC

```{r}
frm = aMCC ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

### OFL amygdala

```{r}
frm = amygdala ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

### OFL FFA

```{r}
frm = FFA ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

### OFL rpSTS

```{r}
frm = rpSTS ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

### OFL rTPJ

```{r}
frm = rTPJ ~ group
t.test(frm, ofl)
1 / ttestBF(formula = frm , data = ofl)
```

## DE - stats


### DE AI

```{r}
frm = AI ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

### DE aMCC

```{r}
frm = aMCC ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

### DE amygdala

```{r}
frm = amygdala ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

### DE FFA

```{r}
frm = FFA ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

### DE rpSTS

```{r}
frm = rpSTS ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

### DE rTPJ

```{r}
frm = rTPJ ~ group
t.test(frm, de)
1 / ttestBF(formula = frm , data = de)
```

## OFL US stats


### OFL AI (US)

```{r}
frm = AI ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```

### OFL aMCC (US)

```{r}
frm = aMCC ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```

### OFL amygdala (US)

```{r}
frm = amygdala ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```

### OFL FFA (US)

```{r}
frm = FFA ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```

### OFL rpSTS (US)

```{r}
frm = rpSTS ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```

### OFL rTPJ (US)

```{r}
frm = rTPJ ~ group
t.test(frm, ofl_us)
1 / ttestBF(formula = frm , data = ofl_us)
```
